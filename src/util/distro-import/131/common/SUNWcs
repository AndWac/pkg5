package SUNWcs
consolidation "osnet"
classification "System/Core"
import SUNWcsu exclude usr/openwin
# BEGIN NON-REDISTRIBUTABLE
drop usr/bin/ksh
drop usr/bin/pfksh
drop usr/bin/rksh
# END NON-REDISTRIBUTABLE
# /usr/has
add dir path=usr/has mode=0755 owner=root group=bin
add dir path=usr/has/bin mode=0755 owner=root group=bin
add dir path=usr/has/lib mode=0755 owner=root group=bin
# Replace BSD vi with vim
chattr usr/bin/edit path=usr/has/bin/edit
chattr usr/bin/ex path=usr/has/bin/ex target=edit
chattr usr/bin/vedit path=usr/has/bin/vedit target=edit
chattr usr/bin/vi path=usr/has/bin/vi target=edit
chattr usr/bin/view path=usr/has/bin/view target=edit
add hardlink path=usr/bin/edit target=../has/bin/edit
add hardlink path=usr/bin/vedit target=../has/bin/edit
# Use the 32-bit ksh93 as a replacement /bin/sh
drop usr/bin/jsh
drop usr/bin/pfsh
drop usr/bin/sh
drop usr/lib/rsh
add file ksh path=usr/bin/ksh mode=0555 owner=root group=bin
add link path=usr/bin/jsh target=ksh93
add link path=usr/bin/pfksh target=ksh93
add link path=usr/bin/pfksh93 target=ksh93
add link path=usr/bin/pfsh target=ksh93
add link path=usr/bin/rksh target=rksh93
add link path=usr/bin/sh target=$(ARCH32)/ksh93
add link path=usr/lib/rsh target=../bin/ksh93
# Replace patch with GNU gpatch
chattr usr/bin/patch path=usr/has/bin/patch
import SUNWcsr
drop etc/inet/hosts
drop etc/nsswitch.conf
drop etc/pam.conf
drop etc/passwd
drop etc/security/policy.conf
drop etc/shadow
drop etc/skel/.profile
drop var/svc/profile/generic_limited_net.xml
drop var/svc/profile/generic_open.xml
drop var/svc/profile/inetd_generic.xml
# Use the 32-bit ksh93 as a replacement /bin/sh
chattr sbin/jsh path=usr/has/bin/jsh
chattr sbin/pfsh path=usr/has/bin/pfsh
chattr sbin/sh path=usr/has/bin/sh
add link path=sbin/jsh \
    target=../usr/bin/ksh93
add link path=sbin/pfsh \
    target=../usr/bin/ksh93
add link path=sbin/sh \
    target=../usr/bin/$(ARCH32)/ksh93
add link path=usr/has/lib/rsh target=../bin/sh
add file hosts path=etc/inet/hosts mode=0644 owner=root group=sys \
    preserve=true
add file services path=etc/inet/services mode=0644 owner=root group=sys \
    preserve=true
add file mailcap \
    path=etc/mailcap \
    mode=0644 \
    owner=root \
    group=bin \
    preserve=true
add file mime.types \
    path=etc/mime.types \
    mode=0644 \
    owner=root \
    group=bin \
    preserve=true
add file policy.conf \
    path=etc/security/policy.conf \
    mode=0644 \
    owner=root \
    group=sys \
    preserve=true
add file .profile \
    path=etc/skel/.profile \
    mode=0644 \
    owner=root \
    group=other \
    preserve=true
add dir path=root mode=0700 owner=root group=root
add file .bashrc \
    path=root/.bashrc \
    mode=0644 \
    owner=root \
    group=root \
    preserve=true
add file .profile \
    path=root/.profile \
    mode=0644 \
    owner=root \
    group=root \
    preserve=true
# switch to gdm
add file generic_open.xml \
    path=var/svc/profile/generic_open.xml \
    mode=0444 \
    owner=root \
    group=sys
add file generic_limited_net.xml \
    path=var/svc/profile/generic_limited_net.xml \
    mode=0444 \
    owner=root \
    group=sys
add file inetd_generic.xml \
    path=var/svc/profile/inetd_generic.xml \
    mode=0444 \
    owner=root \
    group=sys
add file nsswitch.conf \
    path=etc/nsswitch.conf \
    mode=0644 \
    owner=root \
    group=root \
    preserve=true
add file pam.conf \
    path=etc/pam.conf \
    mode=0644 \
    owner=root \
    group=sys \
    preserve=true
add file passwd \
    path=etc/passwd \
    mode=0644 \
    owner=root \
    group=sys \
    preserve=true
add file shadow \
    path=etc/shadow \
    mode=0400 \
    owner=root \
    group=sys \
    preserve=true
# include etc/ftpd/ftpusers in base package
from SUNWftpr import
etc/ftpd
etc/ftpd/ftpusers
end import

#
# The RBAC database files are currently delivered by the legacy SUNWcsr
# package as well as other packages via the "rbac" class.  In order to
# leverage the system/rbac smf(5) service, the global "attrs" file
# chattr_glob's the package's contributions to these databases into a
# per-database directory which the service assembles.  These directories
# for the database files are defined here.
#
add dir path=etc/security/auth_attr.d mode=0755 owner=root group=sys
add dir path=etc/security/exec_attr.d mode=0755 owner=root group=sys
add dir path=etc/security/prof_attr.d mode=0755 owner=root group=sys
add dir path=etc/user_attr.d mode=0755 owner=root group=sys
#
# As we need to package versions of these files for updating from earlier
# releases, the versions of these files as imported by SUNWcsr will serve
# as the "base" versions until the entries are migrated to the
# appropriate packages.  In order for this to occur, the imported files
# will be chattr'ed here to a temporary name and then renamed back via
# the global "attrs" file.  This will prevent the SUNWcsr contribution
# from being globally renamed into the per-database directory.
#
chattr etc/security/auth_attr path=etc/security/auth_attr.SUNWcsr
chattr etc/security/exec_attr path=etc/security/exec_attr.SUNWcsr
chattr etc/security/prof_attr path=etc/security/prof_attr.SUNWcsr
chattr etc/user_attr path=etc/user_attr.SUNWcsr
#
# There are additional entries for exec_attr and prof_attr that are
# currently delivered via SUNWwbcor which need to be moved into SUNWcs.
# Until that time, these will be imported here and renamed under the
# per-database directories.
#
from SUNWwbcor import
etc/security/exec_attr
etc/security/prof_attr
end import
chattr etc/security/exec_attr path=etc/security/exec_attr.d/SUNWwbcor \
    restart_fmri=svc:/system/rbac:default
chattr etc/security/prof_attr path=etc/security/prof_attr.d/SUNWwbcor \
    restart_fmri=svc:/system/rbac:default

add driver name=dump \
    perms="dump 0660 root sys"

add driver name=fssnap \
    perms="* 0640 root sys" \
    perms="ctl 0666 root sys" \
    policy="ctl read_priv_set=sys_config write_priv_set=sys_config"

add driver name=kstat \
    perms="* 0666 root sys"

add driver name=ksyms \
    perms="* 0666 root sys"

add driver name=logindmux

add driver name=ptm \
    clone_perms="ptmx 0666 root sys"

add driver name=pts \
    perms="* 0644 root sys" \
    perms="0 0620 root tty" \
    perms="1 0620 root tty" \
    perms="2 0620 root tty" \
    perms="3 0620 root tty"
end package
