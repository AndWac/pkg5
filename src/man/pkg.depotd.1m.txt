System Administration Commands                           pkg.depotd(1M)


NAME
     pkg.depotd - image packaging system depot server

SYNOPSIS
     /usr/lib/pkg.depotd [-d repo_dir] [-p port] [-s threads]
         [-t socket_timeout] [--content-root] [--log-access] [--log-errors]
         [--mirror] [--proxy-base url] [--readonly] [--rebuild]

DESCRIPTION
     pkg.depotd is the depot server for the image packaging system.
     pkg(1), the retrieval client, makes requests of the depot server
     for catalogs and packages.  pkgsend(1), the publication client,
     sends new versions of packages to the depot server.  pkg.depotd is
     typically run as a service on the system.  Package and software
     developers may wish to run private copies for various testing
     purposes.

     The pkg.depot server is generally configured via the smf(5)
     properties associated with its service.  Eight properties
     are currently recognized:

     pkg/content_root           (astring) The file system path at which
                                the instance should find its static
                                and other web content.  The default
                                value is /usr/share/lib/pkg.

     pkg/inst_root              (astring) The file system path at which
                                the instance should find its repository
                                data.  The default value is
                                /var/pkg/repo.

     pkg/log_access             (astring) The destination for any access
                                related information logged by the depot
                                process.  Possible values are: stderr,
                                stdout, none, or an absolute pathname.
                                The default value is stdout if stdout is
                                a tty; otherwise the default value is
                                none.

     pkg/log_errors             (astring) The destination for any errors
                                or other information logged by the depot
                                process.  Possible values are: stderr,
                                stdout, none, or an absolute pathname.
                                The default value is stderr.

     pkg/port                   (count) The port number on which the
                                instance should listen for incoming
                                package requests.  The default value is
                                80.

     pkg/proxy_base             (uri) This changes the base URL for the
                                depot server and is most useful when
                                running behind Apache or some other
                                webserver in a reverse proxy
                                configuration.

     pkg/socket_timeout         (count) The maximum number of seconds the
                                server should wait for a response from a
                                client before closing a connection.  The
                                default value is 60.

     pkg/threads                (count) The number of threads that will
                                be started to serve requests.  The default
                                value is 10.

OPTIONS
     The following options alter the default behavior, if present, and
     will override the settings from the service instance when managed
     via an smf(5) restarter:

     -d repo_dir                Overrides pkg/inst_root with the value
                                given by repo_dir.

     -p port                    Overrides pkg/port with the value given
                                by port.

     -s threads                 Overrides pkg/threads with the value
                                given by threads.

     -t socket_timeout          Overrides pkg/socket_timeout with the
                                value given by socket_timeout.

     --log-access dest          Overrides pkg/log_access with the value
                                given by dest.

     --log-errors dest          Overrides pkg/log_errors with the value
                                given by dest.

     --content-root root_dir    Overrides pkg/content_root with the value
                                given by root_dir.

     --mirror                   Package mirror mode; publishing and
                                metadata operations are disabled and
                                only a limited browser user interface is
                                provided.  This option may not be
                                combined with the --readonly or
                                --rebuild options.

     --proxy-base url           Overrides pkg/proxy_base with the value
                                given by url.  Ignored if empty value is
                                provided.

     --readonly                 Modifying operations, such as those
                                initiated by pkgsend(1M) are disabled.
                                Retrieval operations are still available.
                                This option may not be combined with the
                                --mirror or --rebuild options.

     --rebuild                  Any existing repository catalog will be
                                destroyed and then recreated on startup.
                                This option may not be combined with the
                                --mirror or --readonly options.

EXAMPLES
     Example 1:  Enabling the depot server.

     # svcadm enable application/pkg/server

     Example 2:  Changing the listening port of the server.

     # svccfg -s application/pkg/server setprop pkg/port = 10000
     # svcadm refresh application/pkg/server
     # svcadm restart application/pkg/server

ENVIRONMENT VARIABLES
     PKG_DEPOT_CONTENT          Specifies the directory containing static
                                content served by the depot.  The files
                                listed below under FILES should be present
                                in this directory, although their content
                                may differ from the supplied default
                                content.

EXIT STATUS
     The following exit values are returned:

     0     Successful operation.

     1     Error encountered.

     2     Invalid command line options were specified.

FILES
     /var/pkg/repo              Default repository location; modify
                                pkg/inst_root to select an
                                alternate location.

     /usr/share/lib/pkg         Default directory containing static content
                                served by the depot.

     /usr/share/lib/pkg/pkg.css Cascading stylesheet.

     /usr/share/lib/pkg/pkg-block-logo.png
                                Package depot logo.

     /usr/share/lib/pkg/pkg-block-icon.png
                                Icon for the package depot server.

     /usr/share/lib/pkg/robots.txt
                                Default robots.txt file which disallows all
                                crawling of the repository.

ATTRIBUTES
     See attributes(5) for descriptions of the  following  attri-
     butes:
     ____________________________________________________________
    |       ATTRIBUTE TYPE        |       ATTRIBUTE VALUE       |
    |_____________________________|_____________________________|
    | Availability                |                             |
    |_____________________________|_____________________________|

SEE ALSO
     pkg(1), pkgsend(1), attributes(5), smf(5)

NOTES
     The image packaging system is an under-development feature.
     Command names, invocation, formats, and operations are all subject
     to change.  Development is hosted in the OpenSolaris community
     at:

     http://opensolaris.org/os/project/pkg/

     The pkd.depotd service is managed by the service  management
     facility, smf(5), under the service identifier:

          svc:/application/pkg/server

     Because the depot server expects to be run by an smf(5) restarter,
     it does not daemonize.  Error messages are generally sent to
     standard output, or to the syslogd(1M) system.

     Changes to configuration require a restart of the depot server process
     so that they can be reflected in operations and output.  This must be
     done when the server is not operating in read-only or mirror mode.

